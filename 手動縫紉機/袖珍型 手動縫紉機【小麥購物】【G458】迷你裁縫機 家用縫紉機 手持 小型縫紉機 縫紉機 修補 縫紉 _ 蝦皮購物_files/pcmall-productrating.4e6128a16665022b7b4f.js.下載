(self.mfeModules=self.mfeModules||[]).push(["",["Platform","React","PlatformApi","Redux","ReactRedux","ReactRouter","WithInjectReducer","FeatureToggles","Account","ReactDom"],(t,e,r,a,n,i,o,c,l,s)=>()=>{(self.wpJsonpPcmallRating=self.wpJsonpPcmallRating||[]).push([[190],{574:(t,e,r)=>{"use strict";r.microfeA(t,(function(){return Promise.all([r.microfeM(0),r.microfeM(1),r.microfeM(2),r.microfeM(3),r.microfeM(4)]).then((function(){t.exports=e,r.d(e,{Z:()=>U});var a={};r.r(a),r.d(a,{likeRating:()=>_,unlikeRating:()=>f});var n=r(3804),i=r.n(n),o=r(6704),c=r(3288),l=r(4505),s=r(6342),u=r(2308),m=r(3398);const{jsonPost:d}=o.FetchUtils,p="/api/v4/seller_operation/like_item_rating";function _(t,e,r){return d(p,{cmt_id:t,shop_id:e,item_id:r,like:!0})}function f(t,e,r){return d(p,{cmt_id:t,shop_id:e,item_id:r,like:!1})}var h=r(264),g=r(4674),v=r(3569),w=r(471),y=r(4725),E=r.n(y);function R(t){const{onClick:e,active:r,content:a}=t;return i().createElement("div",{onClick:()=>{e(t)},className:E()("product-rating-overview__filter",r&&"product-rating-overview__filter--active")},a)}function k(t){const[e,r]=(0,n.useState)(0),{onChange:a,filters:o}=t;return i().createElement("div",{className:"product-rating-overview__filters"},o.map(((t,n)=>i().createElement(R,{content:t.content,active:e===n,key:n,onClick:()=>{r(n);const e=t.payload;a(e)}}))))}r(5648);const{t:S}=o.I18n,x=(0,v.Kd)();function b(t){return(0,w.compactCurrency)(x,t||0,{precision:!1,symbol:""})}let N=function(t){return t[t.All=0]="All",t[t.WithMedia=1]="WithMedia",t[t.WithComment=2]="WithComment",t[t.RepeatPurchase=3]="RepeatPurchase",t[t.LocalReview=4]="LocalReview",t[t.Star=5]="Star",t}({});function P(t){const{onSwitchFilter:e,ratingScore:r,ratingSummary:a,hideExtraFilter:o,showLocalReview:c,showRepeatPurchase:l}=t,[s]=(0,n.useState)((()=>({all:{type:N.All},withMedia:{type:N.WithMedia},withComment:{type:N.WithComment},repeatPurchase:{type:N.RepeatPurchase},localReview:{type:N.LocalReview},star1:{type:N.Star,value:1},star2:{type:N.Star,value:2},star3:{type:N.Star,value:3},star4:{type:N.Star,value:4},star5:{type:N.Star,value:5}}))),u=(0,n.useMemo)((()=>{const{rcount_local_review:t,rcount_repeat_purchase:e,rcount_with_context:r,rcount_with_media:n,rating_count:i}=a,u=[{content:S("label_all"),payload:{type:N.All}},...[5,4,3,2,1].map((t=>({content:`${t} ${S("label_rating_star")} (${b(i[t-1])})`,payload:s[`star${t}`]})))];return o||(u.push({content:`${S("label_with_comment")} (${b(r||0)})`,payload:s.withComment},{content:`${S("rating_btn_name_ratingfilter_media")} (${b(n||0)})`,payload:s.withMedia}),l&&u.push({payload:s.repeatPurchase,content:`${S("label_repeat_purchase")} (${b(e||0)})`}),c&&u.push({payload:s.localReview,content:`${S("label_local_review")} (${b(t||0)})`})),u}),[s,o,a,c,l]);return i().createElement("div",{className:"product-rating-overview"},i().createElement(C,{ratingScore:r}),i().createElement(k,{filters:u,onChange:e}))}function C(t){const{ratingScore:e}=t;return i().createElement("div",{className:"product-rating-overview__briefing"},i().createElement("div",{className:"product-rating-overview__score-wrapper"},i().createElement("span",{className:"product-rating-overview__rating-score"},e%1==0?e:e&&e.toFixed(1)),i().createElement("span",{className:"product-rating-overview__rating-score-out-of"},S("text_n_out_of_m",{n:"",m:5})+" ")),i().createElement(g.DU,{rating:e,className:"product-rating-overview__stars"}))}var O=r(7821),Z=r(8386),M=r(17),T=r(1677),I=r(6978),W=r(4934);function L(){return L=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},L.apply(this,arguments)}const F=()=>{const{actions:t,state:e}=(0,n.useContext)(M.AccountContext),r=(0,I.tk)(e),{accountStatus:a,accountInfo:{username:i,portrait:o}}=r;return(0,n.useEffect)((()=>{a===W.d.LOGGED_IN?(0,T.RD)({username:i,portrait:o}):a===W.d.NOT_LOGGED_IN&&(0,T.hW)()}),[a,i,o]),L({},r,t)};var A=r(7882),D=r(1923),$=r(6775);function j(t){return{getUrl:function(e){try{return(0,$.generatePath)(t,e||{})}catch(r){return""}}}}const V=j(D.wl);function G(){return G=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},G.apply(this,arguments)}j(D.qB),j(D.qc),j(D.Pj),j(D.gi),j(D.T_),j(D.ZV),j(D.gI),j(D._1),j(D.mI),j(D.S8),j(D.dn),j(D.Ql),j(D.WS),j(D.l0),j(D.ER),j(D.oy),j(D.q),j(D.HJ),j(D.X6),j(D.Iu);const{t:H}=o.I18n,B={filter:l.kZ.NotSpecified,flag:1,limit:6,offset:0,type:l.x7.All,exclude_filter:0,filter_size:0,fold_filter:0,relevant_reviews:!1,request_source:1,tag_filter:"",variation_filters:""},K=Z.n,q=(0,u.Pf)((0,s.wl)((function(t){var e,r,o,c;const{itemId:s,shopId:u,ratingStar:d}=t,p=(0,n.useRef)(null),[_,f]=(0,n.useState)((()=>G({},B,{shopid:u,itemid:s}))),g=()=>{const t=p.current;if(t)try{const e=t.getBoundingClientRect().top+window.pageYOffset,r=window.getComputedStyle(t),a=r.paddingTop?parseInt(r.paddingTop,10):0,n=window.innerHeight,i=document.documentElement.scrollTop||document.body.scrollTop;if(document.documentElement.scrollTop-a<e&&n/2+i>=e)return;t.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}};(0,n.useEffect)((()=>{f(G({},B,{shopid:u,itemid:s}))}),[s,u]);const v=(0,l.NS)(_);(0,n.useDebugValue)(v.data);const w=null==(e=v.data)?void 0:e.data,y=function(){const{accountStatus:t}=F(),e=(0,$.useHistory)();return function(t){const e=(0,n.useRef)(t);return e.current=t,(0,n.useState)((()=>(...t)=>e.current(...t)))[0]}((function(){if(t!==W.d.LOGGED_IN){const t=(0,A.FK)(V.getUrl(),{next:window.location.href});e.push(t)}return t===W.d.LOGGED_IN}))}(),E=null==w?void 0:w.item_rating_summary,R=(0,n.useMemo)((()=>{if(!E)return 0;if(_.type>=1&&_.type<=5)return E.rating_count[_.type-1];switch(_.filter){case l.kZ.WithComment:return E.rcount_with_context;case l.kZ.LocalReview:return E.rcount_local_review;case l.kZ.RepeatPurchase:return E.rcount_repeat_purchase;case l.kZ.WithVideo:return E.rcount_with_media;case l.kZ.WithPhoto:return E.rcount_with_image;case l.kZ.OverallFitFit:return E.rcount_overall_fit_fit;case l.kZ.OverallFitSmall:return E.rcount_overall_fit_small;case l.kZ.OverallFitLarge:return E.rcount_overall_fit_large}return 0}),[_.filter,_.type,E]);if(!w||!E)return null;const k=w.downgrade_switch,S=Math.floor((R-1)/K)+1,x=async(t,e)=>{if(y()){try{await a[e?"likeRating":"unlikeRating"](t.cmtid,t.shopid,t.itemid)}catch(r){}v.mutate((r=>G({},r,{data:G({},r.data,{ratings:r.data.ratings.map((r=>r.cmtid===t.cmtid?G({},r,{like_count:Math.max(0,e?r.like_count+1:r.like_count-1),liked:e}):r))})})))}};return i().createElement("div",{className:"product-ratings",ref:p,"data-nosnippet":!0},i().createElement("div",{className:"product-ratings__header"},i().createElement("div",{className:"product-ratings__header_score"},H("label_product_ratings"))),!k&&i().createElement(P,{ratingScore:d,ratingSummary:E,onSwitchFilter:t=>{const{type:e}=t;f((r=>{var a;const n=null!=(a={[N.Star]:l.kZ.NotSpecified,[N.LocalReview]:l.kZ.LocalReview,[N.RepeatPurchase]:l.kZ.RepeatPurchase,[N.WithComment]:l.kZ.WithComment,[N.WithMedia]:l.kZ.WithVideo,[N.All]:l.kZ.NotSpecified}[e.toString()])?a:l.kZ.NotSpecified;let i=l.x7.All;return e===N.Star&&(i=t.value),r.type===i&&r.filter===n?r:G({},r,{filter:n,type:i,offset:0})})),g()},hideExtraFilter:!1,showLocalReview:null!=(r=w.show_local_review)&&r,showRepeatPurchase:E.rcount_repeat_purchase>0}),0===(null!=(o=null==w?void 0:w.ratings)?o:[]).length?i().createElement("div",{className:"product-ratings-comments-view__no-data"},i().createElement("div",{className:"product-ratings-comments-view__no-data__icon"},i().createElement("img",{src:O.Z,alt:"empty-icon"})),i().createElement("div",{className:"product-ratings-comments-view__no-data__text"},H("text_no_ratings"))):i().createElement("div",{className:"product-ratings__list",style:{opacity:v.pending?.6:1}},i().createElement("div",{className:"shopee-product-comment-list"},(null!=(c=null==w?void 0:w.ratings)?c:[]).map((t=>t&&i().createElement(h.Z,{key:t.cmtid,rating:t,shopId:u,itemId:t.itemid,unlikeRating:async()=>{await x(t,!1)},likeRating:async()=>{await x(t,!0)},productItems:t.product_items})))),i().createElement(m.ZP,{className:"product-ratings__page-controller",totalPageCount:S,selectedPage:Math.floor(_.offset/K),onPageSelected:t=>{g(),f((e=>G({},e,{offset:t*K})))}})))})));function U(t){return i().createElement(l.Og,null,i().createElement(c.Z,{onTrack:o.Tracking.onTrack},i().createElement(q,t)))}}))}))},17:t=>{"use strict";t.exports=l},1437:t=>{"use strict";t.exports=c},6704:t=>{"use strict";t.exports=r},3804:t=>{"use strict";t.exports=e},7274:t=>{"use strict";t.exports=s},5325:t=>{"use strict";t.exports=n},6775:t=>{"use strict";t.exports=i},4857:t=>{"use strict";t.exports=a},7762:t=>{"use strict";t.exports=o}},function(e){"use strict";var r;r=e.x,e.x=()=>{Promise.resolve(e(574)).then((e=>{t.setModule("pcmall-productrating",e.Z,{type:"slot",buildInformation:{updated:"2023-05-31T05:22:45.408Z",tag:"RT-V20230531-WEB-hotfix-0",branch:"heads/RT-V20230531-WEB-hotfix-0",lastCommit:"style(@shopee-rating/microfe-rating-pc): lint style",lastCommitHash:"1aba2a7d37ac7a837261757dbebf2366dfbf2833"},registerSentryDsn:!0,projectAndModuleName:"pcmall-shoprating"}),r()}))}},[[574,666,442,762,527,822,264,938]]])},2]),function(){if(window&&window.__DECKER_HOOK__){var t=window.__DECKER_HOOK__,e=function(){t.sendToDevtools("MFE_LOAD_SLOT",{slotName:"pcmall-productrating",updated:"2023-05-31T05:22:45.434Z",tag:"RT-V20230531-WEB-hotfix-0",branch:"heads/RT-V20230531-WEB-hotfix-0",lastCommit:"style(@shopee-rating/microfe-rating-pc): lint style",lastCommitHash:"1aba2a7d37ac7a837261757dbebf2366dfbf2833"})};t.on("MFE_RETRIEVE_SLOTS",e),e()}}();
//# sourceMappingURL=https://sourcemap.webfe.shopeemobile.com/pcmall-shoprating/_/pcmall-productrating.4e6128a16665022b7b4f.js.map