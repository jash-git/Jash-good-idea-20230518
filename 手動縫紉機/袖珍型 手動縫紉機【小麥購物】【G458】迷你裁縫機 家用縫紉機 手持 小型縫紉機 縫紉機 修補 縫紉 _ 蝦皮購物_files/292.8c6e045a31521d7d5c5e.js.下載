(self.wpJsonpPcmallPcpagevoucherdetail=self.wpJsonpPcmallPcpagevoucherdetail||[]).push([[292],{62258:(e,o,t)=>{"use strict";function c(){return c=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},c.apply(this,arguments)}function r(e,o){return e&&e.recommendedShopVouchers&&e.recommendedShopVouchers[o]||[]}function a(e){return Object.entries(e.claimProgress||[]).reduce(((e,[o,t])=>c({},e,{[o]:t.progress})),{})}function s(e){return Object.entries(e.claimProgress||[]).reduce(((e,[o,t])=>c({},e,{[o]:t.invalid_message_code})),{})}function n(e,o){if(!o)return 0;const t=e.claimProgress[o];return t?t.progress:0}function l(e,o,t){if(!t)return{};const c=e&&e.voucherDetail&&e.voucherDetail[o||"0"];return c&&c[t]||{}}t.d(o,{zq:()=>r,HL:()=>a,OX:()=>s,KT:()=>n,hy:()=>l})},89887:(e,o,t)=>{"use strict";t.a(e,(async e=>{t.d(o,{Z:()=>S});var c=t(63804),r=t.n(c),a=t(809),s=t(33041),n=t(94345),l=t(47643),i=t(66337),u=t(69591),h=t(47472),d=t(86704),_=t(71374),m=t(49300),v=t(53179),p=t(8041),g=t(87867),C=t(85516),Z=t(69231),E=t(99045),b=t(80733),f=t(71574),y=t(1765),k=t(37077),N=t(17221),V=e([s,N]);[s,N]=V.then?await V:V;const S=(0,d.withI18nCollections)([b.L])((function(e){const{appliedVoucher:o,applyVoucher:t,onClaim:b,hasItemSelected:V,claimProgress:S,claimInvalidCodes:B,isCheckout:w,currentBestVoucherCode:I,applyingVoucherCode:O,highlightCode:A,vouchers:P,latestClaimedVoucherByCode:L,closeModal:x,toHighlightInapplicableVoucher:T,shopId:M,fetchProgress:R}=e,[D,H]=(0,c.useState)([]),[W,j]=(0,c.useState)(""),[U,F]=(0,c.useState)(null);(0,c.useEffect)((()=>{H(P)}),[]),(0,c.useEffect)((()=>{if(!L)return;const{voucher:e,invalid_message_code:o}=L;if(!e)return;const t=!(null!=e&&e.invalid_message_code);o?o===f.eg.CLAIM_ERROR_EXIST?t&&F(e):H((o=>[...o.filter((o=>o.voucher_code!==e.voucher_code)),e])):t?(H((o=>[e,...o.filter((o=>o.voucher_code!==e.voucher_code))])),F(e)):H((o=>[...o.filter((o=>o.voucher_code!==e.voucher_code)),e]))}),[L]);const K=(0,y.Z)((w?"Checkout.":"Cart.")+"action_voucher_toast");(0,c.useEffect)((()=>{if(!o)return;const e=o&&P.find((e=>e.voucher_code===o.voucher_code));F(null),(0,_.y2)(null==e?void 0:e.invalid_message_code)?($((0,d.t)("msg_invalid_voucher_unapplied")),K({shopid:M,toast_msg:"unapply_invalid_vouchers"}),t&&t(null,!1,!1)):e&&(F(e),H((t=>[e,...null==t?void 0:t.filter((e=>e.voucher_code!==o.voucher_code))])),T&&(0,_.Yu)(null==e?void 0:e.invalid_message_code)&&j(o.voucher_code||""))}),[null==o?void 0:o.voucher_code]);const Q=(0,c.useCallback)((()=>{let e=-1;return U&&(e=D.findIndex((e=>e.voucher_code===U.voucher_code))),{shopid:M,promotion_id:(null==U?void 0:U.promotionid)||-1,voucher_index:e,is_best_voucher:(null==U?void 0:U.voucher_code)===I}}),[I,U,M,D]),z=(0,k.Z)("OKButton",Q()),Y=(0,y.Z)(w?"applyVoucherSuccessfulCheckout":"applyVoucherSuccessful"),q=R===E.Z.OK&&!P.length,G=(0,k.Z)("CloseButton",{shopid:M,display_no_shop_vc_icon:q}),[J,$]=(0,c.useState)(""),[X,ee]=(0,c.useState)(!1),oe=(0,g.oW)(),te=(0,g.T_)(),ce=(0,c.useCallback)((e=>{if(w)return;const o=(0,m.O)(e,oe,te);window.open(o,"_blank","noreferrer")}),[oe,w,te]),re=(0,c.useCallback)((e=>{const o=e.invalid_message_code,t=(0,_.y2)(o),c=(0,_.Yu)(o),r=null==B?void 0:B[e.voucher_code||""],a=e.is_claimed_before||(null==S?void 0:S[e.voucher_code])===E.Z.OK;return V?(0,_.sg)(r)?($((0,v.GN)(r)),void K({shopid:M,toast_msg:(0,_.QD)(r||0)})):t?($((0,v.R8)(e.invalid_message_code||0)),void K({shopid:M,toast_msg:(0,_.Ph)(e.invalid_message_code||0)})):c?(null==U?void 0:U.voucher_code)===e.voucher_code?void F(null):void ce(e):a?t||c?void 0:(j(""),void((null==U?void 0:U.voucher_code)===e.voucher_code?F(null):F(e))):void ce(e):a?($((0,d.t)("voucher_card_shop_no_items_selected")),void K({shopid:M,toast_msg:"no_item_selected"})):void ce(e)}),[B,S,U,K,V,ce,M]),ae=(0,c.useCallback)((()=>{ee(!0)}),[]),se=(0,c.useCallback)((()=>{ee(!1)}),[]),ne=(0,c.useCallback)((()=>{F(null),se()}),[se]),le=(0,c.useCallback)((()=>{z(),T&&null!=U&&U.invalid_message_code?ae():(t&&t(U,(null==U?void 0:U.voucher_code)===I).then((e=>{!e||0!==e.error||null!=e&&e.invalidMessageCode||Y({isCheckout:w,shopid:M,promotion_id:null==U?void 0:U.promotionid,display_no_shop_vc_icon:q}),e&&e.invalidMessageCode&&K({shopid:M,toast_msg:(0,_.QD)(e.invalidMessageCode)})})),x())}),[z,T,U,t,I,x,ae,Y,w,M,q,K]),[ie,ue]=(0,c.useState)(!1);return r().createElement(r().Fragment,null,r().createElement(n.Z,{show:!!J,text:J,onDismiss:()=>{$("")},anchorClassName:Z.Z.errorToastAnchor}),X&&r().createElement(a.Z,{message:(0,d.t)("msg_unapply_inapplicable_vouchers"),cancelText:(0,d.t)("label_voucher_leave_page"),confirmText:(0,d.t)("label_unapply_vouchers"),title:(0,d.t)("msg_voucher_cannot_be_applied"),onConfirm:ne,onCancel:()=>{se(),x()},onClickOverlay:se,trackData:{shopid:M}}),ie&&r().createElement(h.Z,{onClickMainButton:()=>ue(!1),onClickOverlay:()=>ue(!1),anchor:document.getElementById("shopVouchersModal")||void 0},r().createElement("p",null,(0,d.t)("voucher_selection_popup_coins_cashback_content"))),r().createElement(N.xm,null,D.length>0&&r().createElement("ul",{className:Z.Z.voucherListWithBottom},D.map(((e,o)=>r().createElement(s.Z,{voucher:e,className:Z.Z.voucherCardBody,key:o,voucherLocation:o,isBestChoice:e.voucher_code===I,onClaim:b,isApplying:e.voucher_code===O,claimProgress:null==S?void 0:S[e.voucher_code||""],claimInvalidCode:null==B?void 0:B[e.voucher_code||""],highlighted:e.voucher_code===A,isCheckout:w,selectVoucher:()=>re(e),currentlyApplyingVoucher:U,borderColor:W===e.voucher_code?f.kv:null,isItemSelected:V}))))),r().createElement("div",{className:Z.Z.statsContainer},U&&r().createElement("div",{className:Z.Z.stats},r().createElement("span",{className:Z.Z.statsText},(0,d.t)("msg_drawer_one_voucher_selected")," ",r().createElement("span",{className:Z.Z.statStyling},(e=>{if(!e)return null;const o=(0,p.Kd)(),{reward_type:t,coin_earned:c,used_price:a}=e;switch(t){case f.$P.COIN_CASHBACK_VOUCHER:return r().createElement(r().Fragment,null,(0,d.t)("label_coin_cashback_value_summary",{n:(0,C.G)(c||0)}));case f.$P.NORMAL_VOUCHER:return r().createElement(r().Fragment,null,(0,d.t)("label_discount_value_summary",{n:(0,C.ce)(a||0,o)}));default:return null}})(U))," ",(0,_.Le)(U)?r().createElement("span",{className:Z.Z.ccbVoucherHelp,role:"button",onClick:()=>ue(!0)},r().createElement(u.Z,null)):null))),r().createElement("div",{className:Z.Z.buttonsRow},r().createElement(i.Lw,{label:(0,d.t)("voucher_label_cancel"),onClick:()=>{G(),x()}}),r().createElement(l.nQ,{onClick:le,className:Z.Z.okBtn},(0,d.t)("voucher_label_ok"))))}))}))},33041:(e,o,t)=>{"use strict";t.a(e,(async e=>{t.d(o,{Z:()=>S});var c=t(63804),r=t.n(c),a=t(44653),s=t(67928),n=t(55486),l=t(19658),i=t(42968),u=t(86704),h=t(80733),d=t(71374),_=t(28567),m=t.n(_),v=t(71574),p=t(99045),g=t(37077),C=t(93991),Z=t(34600),E=t(1704),b=t(96370),f=t(71437),y=t(63300),k=t(17221),N=e([b,k]);function V(){return V=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},V.apply(this,arguments)}[b,k]=N.then?await N:N;const S=(0,u.withI18nCollections)([h.L,h.ez])((function({voucher:e,className:o,voucherLocation:t,isBestChoice:h,claimProgress:_,claimInvalidCode:N,highlighted:S,onClaim:B,isCheckout:w,selectVoucher:I,currentlyApplyingVoucher:O,borderColor:A,isItemSelected:P}){const[L,x]=(0,c.useState)(!1),T=(0,c.useCallback)((e=>{x(e)}),[x]),[M,R]=(0,c.useState)(!1),{is_claimed_before:D,invalid_message_code:H,voucher_code:W}=e,j=!H,U=(0,d.sg)(N),F=U||(0,d.y2)(H),K=D||_===p.Z.OK,Q=(null==O?void 0:O.voucher_code)===W,[z,Y]=(0,c.useState)(0),q=j&&h,G={shopid:e.shop_id,promotion_id:e.promotionid,voucher_index:t,button_type:(0,s.Yt)(e),status:(0,d.wP)(e),is_best_voucher:h,reason:e.invalid_message_code?v.me[e.invalid_message_code]:"",usage_progress:e.percentage_used,claim_status:K,applicable_status:!H,valid_status:!F,select_status:Q},J=(0,g.Z)("ClaimButton",G),$=(0,g.Z)("VoucherActionButton",G),X=(0,C.Z)("ShopVoucherCard",G),ee=(0,g.Z)("ShopVoucherCard",G),oe=(0,g.Z)("VoucherActionButton",V({},G,{button_type:""})),te=(0,d.wH)(P,K,H),ce=(0,d.LB)(P,K),re=(0,d.XI)(P,e.invalid_message_code),ae=r().useMemo((()=>K?e.remaining_usage_limit||0:e.usage_limit_per_user||0),[K,e]),se=(0,c.useMemo)((()=>K&&M?new Array(e.remaining_usage_limit).fill(e):[e]),[K,e,M]),ne=(0,c.useCallback)((e=>{F?I():(Q&&z!==e||I(),Y((o=>{if(o!==e||!Q)return e})))}),[I,Q,z,F]),le=(0,c.useCallback)((()=>{R((e=>!e))}),[]),ie=e=>{ee(),ne(e)},{claim:ue}=(0,k.z7)({voucher:e,onClaim:B});return r().createElement(r().Fragment,null,se.map(((c,d)=>(0,f.isFeatureEnabled)(y.d9B)?r().createElement(b.CartPageVoucher,{key:d,isBestChoice:!!h,voucher:e,progress:_,itemSelected:P,onClick:()=>ie(d),isSelected:Q&&z===d,isDisabled:F,highlight:!!S,claim:ue,isClaimError:U,isCheckout:!!w,trackingData:V({},G,{voucherLocation:t,voucher:e})}):r().createElement("div",{key:JSON.stringify(M)+`${d}`,className:m()(Z.Z.voucherWrapper,ae>1&&(!K||L)&&Z.Z.withBottomBorder),ref:X},ae>1&&(!K||L)&&r().createElement(a.ZD,{num:K?e.remaining_usage_limit||0:e.usage_limit_per_user||0,className:Z.Z.rightCorner,iconClassName:Z.Z.iconClassName}),r().createElement(a.rO,{onClick:()=>ie(d),className:m()(o,Z.Z.voucherBody),voucher:e},r().createElement(a.Tg,{voucher:e,className:m()(Z.Z.voucherLeft,S&&z===d?Z.Z.highlight:Z.Z.unhighlight,te&&Z.Z.inapplicableVoucher),voucherLocation:t,borderColor:A},r().createElement(a.Mg,{sizeStyle:"big"})),F&&r().createElement(l.eP,{errCode:N||H||0,isClaimError:U}),r().createElement(a.Ec,{className:m()(Z.Z.voucherRightContainer,S&&z===d?Z.Z.highlight:Z.Z.unhighlight),voucherLocation:t,voucher:e,borderColor:A},r().createElement("div",{className:m()(Z.Z.voucherRightInfo,te&&Z.Z.inapplicableVoucher)},r().createElement(a.PU,{className:Z.Z.header}),r().createElement(a.s_,{voucher:e}),r().createElement(a.EU,{className:Z.Z.expiry,voucher:e})),(!K||L)&&r().createElement(a.h9,{onClaim:B,voucher:e,className:Z.Z.claimBtn,trackClick:J,shouldExpandButtonClickArea:!0,buttonDisabled:F,onAnimationChange:T,needAnimation:!0}),K&&!L&&r().createElement("div",{className:m()(Z.Z.voucherActions,Q&&!j&&Z.Z.fullOpacity)},r().createElement("div",null),r().createElement(n.Z,{isSelected:Q&&z===d,onSelect:()=>{ie(d)},isDisabled:F,disableStyle:te,voucher:e,className:m()(Z.Z.radioWrapper,Z.Z.withTnC)}),r().createElement(i.Z,{className:Z.Z.tc,voucher:e,voucherLocation:t,external:!0,trackingData:G}))),!q&&r().createElement(a.Vp,null)),ae>1&&(!K||L)&&r().createElement("div",{className:Z.Z.bottomBorder}),ce&&r().createElement("div",{className:Z.Z.newErrorMsg,onClick:()=>{oe(),ne(d)}},r().createElement(s.sz,{className:Z.Z.infoIcon}),(0,u.t)("voucher_card_shop_no_items_selected")),re&&r().createElement(s.ZP,{voucher:e,trackClick:$,showButton:!w,preSource:w?void 0:v.j8.CART}),q&&r().createElement("div",{className:Z.Z.cornerBadge},(0,u.t)("label_voucher_best_choice"))))),ae>1&&K&&!L&&r().createElement("div",{className:Z.Z.expand,onClick:le},(0,u.t)(M?"max_distribution_per_buyer_collapse":"max_distribution_per_buyer_show",{count:e.remaining_usage_limit}),r().createElement(E.Z,{className:m()(Z.Z.arrow,M&&Z.Z.arrowUp)})))}))}))},15728:(e,o,t)=>{"use strict";t.d(o,{Z:()=>b});var c=t(63804),r=t.n(c),a=t(44653),s=t(55486),n=t(55656),l=t(67928),i=t(86704),u=t(80733),h=t(71374),d=t(49300),_=t(28567),m=t.n(_),v=t(71574),p=t(99045),g=t(37077),C=t(93991),Z=t(34600),E=t(87867);const b=(0,i.withI18nCollections)([u.L])((function({voucher:e,className:o,voucherLocation:t,isBestChoice:u,isCurrentlyApplied:_,onUnapply:b,isDisabled:f,claimProgress:y,highlighted:k,onClaim:N,isCheckout:V,isSelected:S,onSelect:B}){const[w,I]=(0,c.useState)(!1),O=(0,c.useCallback)((e=>{I(e)}),[I]),A=!e.invalid_message_code,P=(A||f)&&!_,L=e.is_claimed_before||y===p.Z.OK,x=A&&u&&!f,T={shopid:e.shop_id,promotion_id:e.promotionid,voucher_index:t,button_type:(0,l.Yt)(e),status:(0,h.wP)(e),is_best_voucher:u,reason:e.invalid_message_code?v.me[e.invalid_message_code]:"",usage_progress:e.percentage_used},M=(0,g.Z)("ApplyButton",T),R=(0,g.Z)("UnapplyButton",T),D=(0,g.Z)("ClaimButton",T),H=(0,g.Z)("VoucherActionButton",T),W=(0,C.Z)("ShopVoucherCard",T),j=(0,g.Z)("ShopVoucherCard",T),U=(0,E.oW)(),F=(0,E.T_)(),K=(0,c.useCallback)((()=>{if(V)return;const o=(0,d.O)(e,U,F);window.open(o,"_blank")}),[V,e,U,F]),Q=r().useMemo((()=>L?e.remaining_usage_limit||0:e.usage_limit_per_user||0),[L,e]);return r().createElement("div",{className:m()(Z.Z.voucherWrapper,Q>1&&Z.Z.withBottomBorder),ref:W},Q>1&&r().createElement("div",{className:Z.Z.bottomBorder}),Q>1&&r().createElement(a.ZD,{num:L?e.remaining_usage_limit||0:e.usage_limit_per_user||0,className:Z.Z.rightCorner,iconClassName:Z.Z.iconClassName}),r().createElement(a.rO,{onClick:j,className:m()(o,Z.Z.voucherBody,!A&&!f&&Z.Z.inapplicableVoucher),voucher:e},r().createElement(a.Tg,{voucher:e,className:m()(Z.Z.voucherLeft,k?Z.Z.highlight:Z.Z.unhighlight),voucherLocation:t},r().createElement(a.Mg,{sizeStyle:"big"})),r().createElement(a.Ec,{className:m()(Z.Z.voucherRightContainer,k?Z.Z.highlight:Z.Z.unhighlight),voucherLocation:t,voucher:e,onClick:K},r().createElement("div",{className:Z.Z.voucherRightInfo},r().createElement(a.PU,{className:Z.Z.header}),r().createElement(a.s_,{voucher:e}),r().createElement(a.EU,{className:Z.Z.expiry,voucher:e})),(P&&!L||w)&&r().createElement(a.h9,{onClaim:N,voucher:e,className:Z.Z.claimBtn,trackClick:D,onAnimationChange:O,needAnimation:!0}),P&&L&&!w&&r().createElement(s.Z,{voucher:e,isDisabled:f,isSelected:S||!1,onSelect:()=>{B&&B(e),M()}})),_&&r().createElement("div",{className:Z.Z.closingIcon,onClick:()=>{R(),b&&b(e)}},r().createElement(n.Z,null)),!x&&r().createElement(a.Vp,null)),!A&&!f&&r().createElement(l.ZP,{voucher:e,trackClick:H,showButton:!V,preSource:V?void 0:v.j8.CART}),x&&r().createElement("div",{className:Z.Z.cornerBadge},(0,i.t)("label_voucher_best_choice")))}))},88270:(e,o,t)=>{"use strict";t.microfeA(e,(function(){return Promise.all([t.microfeM(0),t.microfeM(1),t.microfeM(2),t.microfeM(3),t.microfeM(4)]).then((function(){e.exports=o,t.a(e,(async e=>{t.d(o,{Z:()=>H});var c=t(63804),r=t.n(c),a=t(95325),s=t(62118),n=t(15728),l=t(70132),i=t(63928),u=t(55109),h=t(44653),d=t(89887),_=t(44212),m=t(99045),v=t(62258),p=t(30143),g=t(40235),C=t(91241),Z=t(53179),E=t(87789),b=t(86704),f=t(80733),y=t(28567),k=t.n(y),N=t(24341),V=t(46773),S=t(93991),B=t(37077),w=t(1765),I=t(15944),O=t(47643),A=t(66337),P=t(71437),L=t(63300),x=t(69231),T=t(2608),M=t(71374),R=e([d]);function D(){return D=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&(e[c]=t[c])}return e},D.apply(this,arguments)}d=(R.then?await R:R)[0];const H=(0,T.Z)((0,b.withI18nCollections)([f.L])((function(e){const{shopInfo:o,hasItemSelected:t,currentVoucher:f,applyVoucher:y,unapplyVoucher:T,validateInfo:R,closeModal:H,setToast:W,isCheckout:j,setDiscoverableVoucher:U,toHighlightInapplicableVoucher:F,pcPopupContextValue:K,isCoinApplied:Q}=e,z=(0,a.useSelector)((e=>(0,v.zq)(e.voucher,o&&o.shopid||0))),Y=(0,a.useSelector)((e=>o&&e.voucher.recommendedShopVouchers.progress||m.Z.INIT)),q=Y===m.Z.INIT||Y===m.Z.REQ,G=Y===m.Z.ERR,J=Y===m.Z.OK&&!z.length,$=Y===m.Z.OK&&!!z.length,X=function(e,o){const[t,r]=(0,c.useState)();return(0,c.useEffect)((()=>{o||r(e.length?e[0].voucher_code:"")}),[o,e]),t}(z,q),ee=(0,a.useSelector)((e=>(0,v.HL)(e.voucher))),oe=(0,a.useSelector)((e=>(0,v.OX)(e.voucher))),te=j?"CheckoutPage":"CartPage",ce=(0,S.Z)(`${te}.ShopVoucher`,e),re=(0,S.Z)(`${te}.EmptyShopVoucher`,e),ae=(0,B.Z)(`${te}.ShopVouchers.ApplyCodeButton`,{shopid:o&&o.shopid,display_no_shop_vc_icon:J}),se=(0,w.Z)(j?"saveVoucherCodeUnsuccessfulCheckout":"saveVoucherCodeUnsuccessful"),ne=(0,w.Z)(j?"applyVoucherSuccessfulCheckout":"applyVoucherSuccessful"),{highlightCode:le,setHighlightVoucher:ie}=(0,V.Z)(),{scrollToTop:ue,containerRef:he}=function(e){const o=(0,c.useRef)(),t=o.current;return(0,c.useEffect)((()=>{e(t)}),[t,e]),{containerRef:o,scrollToTop:(0,c.useCallback)((()=>{t&&requestAnimationFrame((()=>{t.scrollTop=0}))}),[t])}}(ce),[de,_e]=(0,c.useState)(""),[me,ve]=(0,c.useState)(),[pe,ge]=(0,c.useState)(null),Ce=(0,P.isFeatureEnabled)(L.Atk),{isRedeeming:Ze,setRedeeming:Ee,inputError:be,inputInfo:fe,setInputErrorCode:ye,currentCode:ke,setInputVoucherCode:Ne}=(0,N.Z)(),[Ve,Se]=(0,c.useState)(void 0),Be=(0,c.useCallback)((e=>{Se((o=>o&&o.voucher_code===e.voucher_code?void 0:e))}),[Se,Ve]),we=(0,a.useDispatch)(),Ie=function(e){const o=(0,a.useDispatch)();return(0,c.useCallback)((async t=>{let c=0,r={};const{response:a,error:s}=await o((0,p.i)({voucher_code:t,shopid:e&&e.shopid||0}));return s||!a||a.error||!a.data?c=-1:(a.data.invalid_message_code&&(c=a.data.invalid_message_code),a.data.voucher&&(t=a.data.voucher.voucher_code||""),a.data.error_config&&(r=a.data.error_config||{})),{claimError:c,voucherCode:t,errorConfig:r}}),[o,e])}(o),Oe=function(e,o){return(0,c.useCallback)((async t=>{let c=0,r=null;const a=D({},e,{shopOrders:e.singleShopOrders||[]}),s=(0,E.pS)(t,a,o),{response:n,error:l}=await(0,g.Vk)(s);return l||!n||n.error||!n.data?c=-1:n.data.voucher&&(r=n.data.voucher,c=r.invalid_message_code||0),{validateError:c,voucher:r}}),[e,o])}(R,Q),Ae=(0,c.useCallback)((e=>{e&&(we((0,p.iT)(e)),ie(e),Ce||ue())}),[we,Ce,ue,ie]),Pe=(0,c.useCallback)((e=>{e&&we((0,p.zd)(e))}),[we]),Le=(0,c.useCallback)((e=>{e&&we((0,p.G2)(e))}),[we]),xe=(0,c.useCallback)((async()=>{Ee(!0),ae();let e=!1;const{claimError:t,voucherCode:c,errorConfig:r}=await Ie(ke);if(t){if(!(0,Z.AP)(t))return Ee(!1),se({shopid:o&&o.shopid,error_code:t,display_no_shop_vc_icon:J,voucher_code:c}),void(r.use_link?ve(r):ye(t,!0,r.content));e=!0}const{validateError:a,voucher:s}=await Oe(c);if(a||e)return Ee(!1),e&&!a||(0,C.LV)(a||0)?(ye(e?t:a,e),Ae(s),U&&U(s)):ye(a),void se({shopid:o&&o.shopid,error_code:t,apply_error_code:a,display_no_shop_vc_icon:J,voucher_code:c});if(!s||Ce)return Ee(!1),void(s&&ge({voucher:s,invalid_message_code:t}));const n=s.voucher_code===X,{error:l,invalidMessageCode:i}=await y(s,n,!0);Ee(!1),l?(Ae(s),se({shopid:o&&o.shopid,error_code:t,apply_error_code:-1,display_no_shop_vc_icon:J,voucher_code:c}),ye(-1)):i?(0,C.LV)(i||0)?(s.invalid_message_code=i,Ae(s)):(se({shopid:o&&o.shopid,error_code:t,apply_error_code:i,display_no_shop_vc_icon:J,voucher_code:c}),ye(i)):(ne({shopid:o&&o.shopid,display_no_shop_vc_icon:J,promotion_id:s.promotionid}),H())}),[Ae,y,H,X,ke,J,Ce,Ie,U,ye,Ee,o,ae,ne,se,Oe]),Te=(0,c.useCallback)((async(e,t=!1)=>{const c=e.voucher_code||"";_e(c);const{validateError:r,voucher:a}=await Oe(c);if(r)return!t&&W((0,Z.Wf)(r),!0),(0,C.LV)(r||0)?Le(a):t||Pe(a),void _e("");if(!a)return void _e("");const s=a.voucher_code===X,{invalidMessageCode:n}=await y(a,s&&t,t,t);(0,C.LV)(n||0)?(a.invalid_message_code=n,Le(a)):(0,C.fD)(n||0)?!t&&Pe(a):n||(ne({shopid:o&&o.shopid,display_no_shop_vc_icon:J,promotion_id:a&&a.promotionid}),H())}),[y,H,X,J,Pe,W,o,ne,Le,Oe]),Me=(0,c.useCallback)((async e=>{const{error:o}=await T(e);o&&W((0,Z.Wf)(-1),!0)}),[W,T]),Re=(0,w.Z)((j?"Checkout.":"Cart.")+"action_voucher_toast"),De=(0,c.useCallback)((async(e,t)=>{if(t)return se({shopid:o&&o.shopid,error_code:t,promotion_id:e&&e.promotionid}),W((0,Z.GN)(t),!0),void Re({shopid:(null==o?void 0:o.shopid)||0,toast_msg:(0,M.QD)(t)});e.voucher_code===X&&await Te(e,!0)}),[X,Re,Te,W,o,se]),{appliedVoucher:He,otherVouchers:We,hasApplicableVouchers:je}=function(e,o){return(0,c.useMemo)((()=>{const t=[];let c,r=!1;for(const a of o)e&&a.voucher_code===e.voucher_code?c=e&&D({},a,{invalid_message_code:e.invalid_message_code,used_price:e.discount_value}):(a.invalid_message_code||(r=!0),t.push(a));return{appliedVoucher:c,otherVouchers:t,hasApplicableVouchers:r}}),[e,o])}(f,z),Ue=(0,c.useRef)();Ue.current={shopid:o&&o.shopid,voucher_code:ke};const Fe=(0,c.useCallback)((()=>{Ve&&(Te(Ve),Se(void 0))}),[Te,Ve]),Ke=(0,c.useCallback)((()=>{H(),Se(void 0)}),[Se,H]),Qe=`${te}.ShopVouchers`;return r().createElement(_.Ji.Provider,{value:K},r().createElement(I.ZP,{targetType:Qe,targetData:Ue},r().createElement("div",{className:k()(x.Z.container,Ce&&x.Z.withBottomButtonsRow),id:"shopVouchersModal"},r().createElement("h3",{className:x.Z.shopName},(0,b.t)("title_vouchers",{shopName:o&&o.shopname})),r().createElement(s.Z,{error:be,info:fe,onRedeem:xe,voucherCode:ke,onVoucherCodeChange:Ne,isRedeeming:Ze,disabled:q||!t,placeholder:(0,b.t)("label_shop_voucher_input_placeholder"),onClickToast:()=>W((0,b.t)("msg_shop_voucher_input"),!0),showToast:!t}),r().createElement(h.i8,{errorConfig:me,isOpen:Boolean(me),onClose:()=>ve(null)}),r().createElement("div",{className:k()(x.Z.content,$&&x.Z.scrollContent),ref:he},!t&&!q&&!Ce&&r().createElement("p",{className:x.Z.banner},(0,b.t)("msg_shop_voucher_select_items")),q&&r().createElement(u.Z,{show:!0,hideOverlay:!0}),G&&r().createElement(l.Z,{title:(0,b.t)("title_shop_data_error"),message:(0,b.t)("msg_shop_data_error")}),J&&r().createElement(i.P,{title:(0,b.t)("title_shop_no_voucher"),message:(0,b.t)("msg_shop_no_voucher"),ref:re}),$&&(He||!t||je||Ce&&z.length?Ce?r().createElement(d.Z,{appliedVoucher:He,applyVoucher:y,onClaim:De,hasItemSelected:t,claimProgress:ee,claimInvalidCodes:oe,isCheckout:j,currentBestVoucherCode:X,vouchers:z,applyingVoucherCode:de,highlightCode:le,latestClaimedVoucherByCode:pe,closeModal:H,toHighlightInapplicableVoucher:F,shopId:o&&o.shopid||0,fetchProgress:Y}):r().createElement(r().Fragment,null,!!He&&r().createElement(r().Fragment,null,r().createElement("div",{className:x.Z.voucherSectionHeader},(0,b.t)("label_applied_vouchers")," ",r().createElement(C.Mo,{voucher:He})),r().createElement(n.Z,{voucher:He,className:x.Z.voucherCardBody,isBestChoice:He.voucher_code===X,isCurrentlyApplied:!0,onUnapply:Me,onApply:Te,onClaim:De,isDisabled:!t,onSelect:Be,isSelected:!!Ve&&He.voucher_code===Ve.voucher_code,isApplying:He.voucher_code===de,claimProgress:ee[He.voucher_code||""],highlighted:He.voucher_code===le,isCheckout:j}),We.length>0&&r().createElement("div",{className:x.Z.voucherSectionHeader},(0,b.t)("label_other_vouchers"))),!He&&t&&!je&&r().createElement("div",{className:k()(x.Z.voucherSectionHeader,x.Z.textLight)},(0,b.t)("msg_no_applicable_vouchers")),r().createElement("ul",{className:x.Z.voucherList},We.map(((e,o)=>r().createElement(n.Z,{voucher:e,className:x.Z.voucherCardBody,key:o,voucherLocation:o,isBestChoice:e.voucher_code===X,onSelect:Be,isSelected:!!Ve&&e.voucher_code===Ve.voucher_code,onUnapply:Me,onApply:Te,onClaim:De,isDisabled:!t,isApplying:e.voucher_code===de,claimProgress:ee[e.voucher_code||""],highlighted:e.voucher_code===le,isCheckout:j}))))):r().createElement("div",{className:k()(x.Z.voucherSectionHeader,x.Z.textLight)},(0,b.t)("msg_no_applicable_vouchers")))),!Ce&&r().createElement("div",{className:x.Z.footer},r().createElement(A.Ig,{classnames:x.Z.cancelButton,onClick:Ke},(0,b.t)("voucher_label_cancel")),r().createElement(O.nQ,{className:x.Z.okButton,onClick:Fe},(0,b.t)("voucher_label_ok"))))))})))}))}))}))},34600:(e,o,t)=>{"use strict";t.d(o,{Z:()=>c});const c={voucherWrapper:"HhaP8y",voucherBody:"IpEgdW",arrow:"_2gEmoP",arrowUp:"r-Tmo3",expand:"N2cr-b",withBottomBorder:"glekBN",bottomBorder:"QyYT8O",voucherRightInfo:"eYeNDY",voucherRightContainer:"kTD5hW",voucherLeft:"_6Ygp4h",logo:"Cx82qQ",expiry:"cWaZgv",header:"vgh-23",claimBtn:"JPDlMO",cornerBadge:"vV9Aex",closingIcon:"_6gLZpx",inapplicableVoucher:"EwoHdT",highlight:"_1NDEIQ",unhighlight:"M0Uu4G",radioWrapper:"Bo6Khd",tc:"RAj1En",voucherActions:"Ycmhx2",fullOpacity:"XKNNMF",newErrorMsg:"dbTVkk",infoIcon:"jH1VsD"}},69231:(e,o,t)=>{"use strict";t.d(o,{Z:()=>c});const c={container:"k857Ih",withBottomButtonsRow:"g1MlJb",shopName:"_2w52wc",content:"+idyFV",cancelButton:"oHGSEs",okButton:"Bb4bKd",footer:"tfxdgi",scrollContent:"Bk+p3j",emptyContainer:"_7G9ags",banner:"-I7x+n",newUINoItemSelectedError:"F00lx-",notifIcon:"BRtEgs",voucherCardBody:"qqrAxz",voucherList:"WEtW44",voucherListWithBottom:"W8WT2r",voucherSectionHeader:"_7zlQBA",textLight:"k4uUwu",buttonsRow:"qll9xC",okBtn:"jisMFY",statsContainer:"yIJbm-",stats:"_8V7enQ",statsText:"Qqtdvc",statStyling:"D6+4+u",errorToastAnchor:"bf-d0L",ccbVoucherHelp:"Lvbggc"}}}]);
//# sourceMappingURL=https://sourcemap.webfe.shopeemobile.com/pcmall-voucher/_/292.8c6e045a31521d7d5c5e.js.map